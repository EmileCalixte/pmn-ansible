---
## Play
- hosts: app_hosting

  tasks:
    - name: Install apache2
      apt:
        name:
          - apache2
          - php7.3

    - name: Check if dokuwiki is already installed
      stat:
        path: /usr/src/dokuwiki
      register: dokuwiki_directory

    - name: Delete dokuwiki file if is not directory
      file:
        path: /usr/src/dokuwiki
        state: absent
      when: dokuwiki_directory.stat.exists and not dokuwiki_directory.stat.isdir

    - name: Download dokuwiki
      get_url:
        url: https://download.dokuwiki.org/src/dokuwiki/dokuwiki-stable.tgz
        dest: /usr/src
      when: not dokuwiki_directory.stat.exists or not dokuwiki_directory.stat.isdir

    - name: Unzip dokuwiki
      unarchive:
        remote_src: yes # The archive is already on the remote machine, not on the control machine
        src: /usr/src/dokuwiki-stable.tgz
        dest: /usr/src
      when: not dokuwiki_directory.stat.exists or not dokuwiki_directory.stat.isdir

    - name: Rename dokuwiki directory
      command: mv /usr/src/dokuwiki-2020-07-29 /usr/src/dokuwiki
      when: not dokuwiki_directory.stat.exists or not dokuwiki_directory.stat.isdir

    - name: Delete downloaded archive
      file:
        path: /usr/src/dokuwiki-stable.tgz
        state: absent
      when: not dokuwiki_directory.stat.exists or not dokuwiki_directory.stat.isdir
        
